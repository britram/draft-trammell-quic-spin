<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The Latency Spin Bit for the QUIC Transport Protocol</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 525px);
    width: 300px;
    z-index: 1;
  }
  #rfc\.toc {
    top: 15px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-right: 350px;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 25px auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
/*]]>*/</style>


  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 About This Document">
<link href="#rfc.section.2" rel="Chapter" title="2 The Spin Bit Mechanism">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Proposed Short Header Format Including Spin Bit">
<link href="#rfc.section.3" rel="Chapter" title="3 Using the Spin Bit for Passive RTT Measurement">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Limitations">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Illustration">
<link href="#rfc.section.4" rel="Chapter" title="4 Experimental Evaluation">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security and Privacy Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="8 Informative References">
<link href="#rfc.appendix.A" rel="Chapter" title="A The Valid Edge Counter">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.8.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Trammell, B., Ed. and M. Kuehlewind" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-trammell-quic-spinbit-delta-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-3-23" />
  <meta name="dct.abstract" content="This document specifies the experimental addition of a latency spin bit to the QUIC transport protocol and describes how to use it to measure end-to-end latency. It is intended as a delta to the current specification of QUIC. An appendix describes the Valid Edge Counter mechanism, which increases the utility of the spin bit in less than ideal network and traffic conditions without using the QUIC packet number." />
  <meta name="description" content="This document specifies the experimental addition of a latency spin bit to the QUIC transport protocol and describes how to use it to measure end-to-end latency. It is intended as a delta to the current specification of QUIC. An appendix describes the Valid Edge Counter mechanism, which increases the utility of the spin bit in less than ideal network and traffic conditions without using the QUIC packet number." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">QUIC</td>
<td class="right">B. Trammell, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">M. Kuehlewind</td>
</tr>
<tr>
<td class="left">Intended status: Experimental</td>
<td class="right">ETH Zurich</td>
</tr>
<tr>
<td class="left">Expires: September 24, 2018</td>
<td class="right">March 23, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The Latency Spin Bit for the QUIC Transport Protocol<br />
  <span class="filename">draft-trammell-quic-spinbit-delta-latest</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the experimental addition of a latency spin bit to the QUIC transport protocol and describes how to use it to measure end-to-end latency. It is intended as a delta to the current specification of QUIC. An appendix describes the Valid Edge Counter mechanism, which increases the utility of the spin bit in less than ideal network and traffic conditions without using the QUIC packet number.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 24, 2018.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<ul><li>1.1.   <a href="#rfc.section.1.1">About This Document</a>
</li>
</ul><li>2.   <a href="#rfc.section.2">The Spin Bit Mechanism</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Proposed Short Header Format Including Spin Bit</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Using the Spin Bit for Passive RTT Measurement</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">Limitations</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Illustration</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">Experimental Evaluation</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security and Privacy Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a>
</li>
<li>8.   <a href="#rfc.references">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.A">The Valid Edge Counter</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The QUIC transport protocol <a href="#QUIC-TRANS" class="xref">[QUIC-TRANS]</a> is a UDP-encapsulated protocol integrated with Transport Layer Security (TLS) <a href="#TLS" class="xref">[TLS]</a> to encrypt most of its protocol internals, beyond those handshake packets needed to establish or resume a TLS session, and information required to decrypt QUIC packets and to route QUIC packets to the correct machine in a load-balancing situation (the connection ID). In contrast to TCP, QUIC&#8217;s wire image (see <a href="#WIRE-IMAGE" class="xref">[WIRE-IMAGE]</a>) exposes much less information about transport protocol state than TCP&#8217;s wire image. Specifically, the fact that sequence and acknowledgement numbers and timestamps (available in TCP) cannot be seen by on-path observers in QUIC means that passive TCP loss and latency measurement techniques that rely on this information (e.g. <a href="#CACM-TCP" class="xref">[CACM-TCP]</a>, <a href="#TMA-QOF" class="xref">[TMA-QOF]</a>) cannot be easily ported to work with QUIC.</p>
<p id="rfc.section.1.p.2">This document proposes a solution to this problem by adding an explicit signal for passive latency measurability to the QUIC short header: a &#8220;spin bit&#8221;.  Observation of the spin bit provides one RTT sample per RTT to passive observers of QUIC traffic. This document describes the mechanism, how it can be added to QUIC, and how it can be used by passive measurement facilities to generate RTT samples.</p>
<p><a href="#vec" class="xref">Appendix A</a> specifies an additional Valid Edge Counter, which can be used to improve the fidelity of spin bit measurements under less than ideal network and/or traffic conditions.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#about-this-document" id="about-this-document">About This Document</a>
</h1>
<p id="rfc.section.1.1.p.1">This document is maintained in the GitHub repository https://github.com/britram/draft-trammell-quic-spin, and the editor&#8217;s copy is available online at https://britram.github.io/draft-trammell-quic-spin.  Current open issues on the document can be seen at https://github.com/britram/draft-trammell-quic-spin/issues. Comments and suggestions on this document can be made by filing an issue there, or by contacting the editor.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#mechanism" id="mechanism">The Spin Bit Mechanism</a>
</h1>
<p id="rfc.section.2.p.1">The latency spin bit enables latency monitoring from observation points on the network path. Each endpoint, client and server, maintains a spin value, 0 or 1, for each QUIC connection, and sets the spin bit on packets it sends for that connection to the appropriate value (below). It also maintains the highest packet number seen from its peer on the connection. The value is then determined at each endpoint as follows:</p>
<p></p>

<ul>
<li>The server initializes its spin value to 0. When it receives a packet from the client, if that packet has a short header and if it increments the highest packet number seen by the server from the client, it sets the spin value to the spin bit in the received packet.</li>
<li>The client initializes its spin value to 0. When it receives a packet from the server, if the packet has a short header and if it increments the highest packet number seen by the client from the server, it sets the spin value to the opposite of the spin bit in the received packet.</li>
</ul>
<p id="rfc.section.2.p.3">This procedure will cause the spin bit to change value in each direction once per round trip. Observation points can estimate the network latency by observing these changes in the latency spin bit, as described in <a href="#usage" class="xref">Section 3</a>.  See <a href="#illustration" class="xref">Section 3.2</a> for an illustration of this mechanism in action.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#proposed-short-header-format-including-spin-bit" id="proposed-short-header-format-including-spin-bit">Proposed Short Header Format Including Spin Bit</a>
</h1>
<p id="rfc.section.2.1.p.1">Since it is possible to measure handshake RTT without a spin bit, it is sufficient to include the spin bit in the short packet header. The spin bit therefore appears only after version negotiation and connection establishment are completed. As of version -10 of <a href="#QUIC-TRANS" class="xref">[QUIC-TRANS]</a>, this proposal specifies using the fifth most significant bit (0x08) of the first octet in the short header for the spin bit.</p>
<div id="rfc.figure.1"></div>
<div id="fig-short-header"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+
|0|K|1|1|0|S|T T|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Destination Connection ID (0..144)           ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Packet Number (8/16/32)                ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Protected Payload (*)                   ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p class="figure">Figure 1: Short Header Format including proposed Spin Bit</p>
<p id="rfc.section.2.1.p.2">This change limits the number of available short packet types to 4. The short packet type definitions are unchanged.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#usage" id="usage">Using the Spin Bit for Passive RTT Measurement</a>
</h1>
<p id="rfc.section.3.p.1">When a QUIC flow is sending at full rate (i.e., neither application nor flow control limited), the latency spin bit in each direction changes value once per round-trip time (RTT). An on-path observer can observe the time difference between edges in the spin bit signal in a single direction to measure one sample of end-to-end RTT. Note that this measurement, as with passive RTT measurement for TCP, includes any transport protocol delay (e.g., delayed sending of acknowledgements) and/or application layer delay (e.g., waiting for a request to complete). It therefore provides devices on path a good instantaneous estimate of the RTT as experienced by the application. A simple linear smoothing or moving minimum filter can be applied to the stream of RTT information to get a more stable estimate.</p>
<p id="rfc.section.3.p.2">An on-path observer that can see traffic in both directions (from client to server and from server to client) can also use the spin bit to measure &#8220;upstream&#8221; and &#8220;downstream&#8221; component RTT; i.e, the component of the end-to-end RTT attributable to the paths between the observer and the server and the observer and the client, respectively. It does this by measuring the delay between a spin edge observed in the upstream direction and that observed in the downstream direction, and vice versa.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#limitations" id="limitations">Limitations</a>
</h1>
<p id="rfc.section.3.1.p.1">Application-limited and flow-control-limited senders can have application and transport layer delay, respectively, that are much greater than network RTT.  Therefore, the spin bit provides network latency information only when the sender is neither application nor flow control limited. When the sender is application-limited by periodic application traffic, where that period is longer than the RTT, measuring the spin bit provides information about the application period, not the RTT. Simple heuristics based on the observed data rate per flow or changes in the RTT series can be used to reject bad RTT samples due to application or flow control limitation.</p>
<p id="rfc.section.3.1.p.2">Since the spin bit logic at each endpoint considers only samples on packets that advance the largest packet number seen, signal generation itself is resistant to reordering and loss. However, reordering can cause problems at an observer by causing spurious edge detection and therefore low RTT estimates, if reordering occurs across a spin bit flip in the stream. Similarly, should an edge be lost in a burst of lost packets, causing a delayed edge detection and therefore high RTT estimates. When the packet number is observable, observation of the packet number can be used to reject lost and reordered edges.</p>
<p id="rfc.section.3.1.p.3">See also <a href="#vec" class="xref">Appendix A</a> for a proposed enhancement which addresses all of these limitations, even when the packet number is encrypted.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#illustration" id="illustration">Illustration</a>
</h1>
<p id="rfc.section.3.2.p.1">To illustrate the operation of the spin bit, we consider a simplified model of a single path between client and server as a queue with slots for five packets, and assume that both client and server send packets at a constant rate. If each packet moves one slot in the queue per clock tick, note that this bidirectional path has a RTT of 10 ticks.</p>
<p id="rfc.section.3.2.p.2">Initially, during connection establishment, no packets with a spin bit are in flight, as shown in <a href="#illus0" class="xref">Figure 2</a>.</p>
<div id="rfc.figure.2"></div>
<div id="illus0"></div>
<pre>
+--------+   -  -  -  -  -   +--------+
|        |     --------&gt;     |        |
| Client |                   | Server |
|        |     &lt;--------     |        |
+--------+   -  -  -  -  -   +--------+
</pre>
<p class="figure">Figure 2: Initial state, no spin bit between client and server</p>
<p id="rfc.section.3.2.p.3">Either the server, the client, or both can begin sending packets with short headers after connection establishment, as shown in <a href="#illus1" class="xref">Figure 3</a>; here, no spin edges are yet in transit.</p>
<div id="rfc.figure.3"></div>
<div id="illus1"></div>
<pre>
+--------+   0  0  -  -  -   +--------+
|        |     --------&gt;     |        |
| Client |                   | Server |
|        |     &lt;--------     |        |
+--------+   -  -  0  0  0   +--------+
</pre>
<p class="figure">Figure 3: Client and server begin sending packets with spin 0</p>
<p id="rfc.section.3.2.p.4">Once the server&#8217;s first 0-marked packet arrives at the client, the client sets its spin value to 1, and begins sending packets with the spin bit set, as shown in <a href="#illus2" class="xref">Figure 4</a>. The spin edge is now in transit toward the server.</p>
<div id="rfc.figure.4"></div>
<div id="illus2"></div>
<pre>
+--------+   1  0  0  0  0   +--------+
|        |     --------&gt;     |        |
| Client |                   | Server |
|        |     &lt;--------     |        |
+--------+   0  0  0  0  0   +--------+
</pre>
<p class="figure">Figure 4: The bit begins spinning</p>
<p id="rfc.section.3.2.p.5">Five ticks later, this packet arrives at the server, which takes its spin value from it and reflects that value back on the next packet it sends, as shown in <a href="#illus3" class="xref">Figure 5</a>. The spin edge is now in transit toward the client.</p>
<div id="rfc.figure.5"></div>
<div id="illus3"></div>
<pre>
+--------+   1  1  1  1  1   +--------+
|        |     --------&gt;     |        |
| Client |                   | Server |
|        |     &lt;--------     |        |
+--------+   0  0  0  0  1   +--------+
</pre>
<p class="figure">Figure 5: Server reflects the spin edge</p>
<p id="rfc.section.3.2.p.6">Five ticks later, the 1-marked packet arrives at the client, which inverts its spin value and sends the inverted value on the next packet it sends, as shown in <a href="#illus4" class="xref">Figure 6</a>.</p>
<div id="rfc.figure.6"></div>
<div id="illus4"></div>
<pre>
      obs. points  X  Y
+--------+   0  1  1  1  1   +--------+
|        |     --------&gt;     |        |
| Client |                   | Server |
|        |     &lt;--------     |        |
+--------+   1  1  1  1  1   +--------+
                      Y
</pre>
<p class="figure">Figure 6: Client inverts the spin edge</p>
<p id="rfc.section.3.2.p.7">Here we can also see how measurement works. An observer watching the signal at single observation point X in <a href="#illus4" class="xref">Figure 6</a> will see an edge every 10 ticks, i.e. once per RTT. An observer watching the signal at a symmetric observation point Y in <a href="#illus4" class="xref">Figure 6</a> will see a server-client edge 4 ticks after the client-server edge, and a client-server edge 6 ticks after the server-client edge, allowing it to compute component RTT.</p>
<p><a href="#illus5" class="xref">Figure 7</a> shows how this mechanism works in the presence of reordering. Here, packet C carries the spin edge, and packet B is reordered on the way to the client. In this case, the client will begin sending spin 1 after the arrival of C, and ignore the spin bit flip to 1 on packet B, since B &lt; C; i.e. it does not increment the highest packet number seen.</p>
<div id="rfc.figure.7"></div>
<div id="illus5"></div>
<pre>
+--------+   0  0  0  0  0   +--------+
|        |     --------&gt;     |        |
| Client |                   | Server |
|        |     &lt;--------     |        |
+--------+   1  0  1  0  0   +--------+
    PN=      A  C  B  D  E
</pre>
<p class="figure">Figure 7: Handling reordering</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#experimental-evaluation" id="experimental-evaluation">Experimental Evaluation</a>
</h1>
<p id="rfc.section.4.p.1">This document specifies an experimental delta to the QUIC transport protocol.  Specifically, this experimentation is intended to determine:</p>
<p></p>

<ul>
<li>the impact of the addition of the latency spin bit on implementation and specification complexity; and</li>
<li>the accuracy and value of the information derived from spin bit measurement on live network traffic.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security-and-privacy-considerations" id="security-and-privacy-considerations">Security and Privacy Considerations</a>
</h1>
<p id="rfc.section.6.p.1">The spin bit is intended to expose end-to-end RTT to observers along the path, so the privacy considerations for the latency spin bit are essentially the same as those for passive RTT measurement in general.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.7.p.1">This document is derived from <a href="#I-D.trammell-quic-spin" class="xref">[I-D.trammell-quic-spin]</a>, which was the work of the following authors in addition to the editor:</p>
<p></p>

<ul>
<li>Piet De Vaere, ETH Zurich</li>
<li>Roni Even, Huawei</li>
<li>Giuseppe Fioccola, Telecom Italia</li>
<li>Thomas Fossati, Nokia</li>
<li>Marcus Ihlar, Ericsson</li>
<li>Al Morton, AT&amp;T Labs</li>
<li>Emile Stephan, Orange</li>
</ul>
<p id="rfc.section.7.p.3">The QUIC Spin Bit was originally specified by Christian Huitema, and the Valid Edge Counter mechanism in <a href="#vec" class="xref">Appendix A</a> was first specified by Piet De Vaere.</p>
<p id="rfc.section.7.p.4">This work is partially supported by the European Commission under Horizon 2020 grant agreement no. 688421 Measurement and Architecture for a Middleboxed Internet (MAMI), and by the Swiss State Secretariat for Education, Research, and Innovation under contract no. 15.0268. This support does not imply endorsement.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="CACM-TCP">[CACM-TCP]</b></td>
<td class="top">
<a>Strowes, S.</a>, "<a>Passively Measuring TCP Round-Trip Times (in Communications of the ACM)</a>", October 2013.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.trammell-quic-spin">[I-D.trammell-quic-spin]</b></td>
<td class="top">
<a>Trammell, B.</a>, <a>Vaere, P.</a>, <a>Even, R.</a>, <a>Fioccola, G.</a>, <a>Fossati, T.</a>, <a>Ihlar, M.</a>, <a>Morton, A.</a> and <a>S. Emile</a>, "<a href="https://tools.ietf.org/html/draft-trammell-quic-spin-01">The Addition of a Spin Bit to the QUIC Transport Protocol</a>", Internet-Draft draft-trammell-quic-spin-01, December 2017.</td>
</tr>
<tr>
<td class="reference"><b id="QUIC-TRANS">[QUIC-TRANS]</b></td>
<td class="top">
<a>Iyengar, J.</a> and <a>M. Thomson</a>, "<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-10">QUIC: A UDP-Based Multiplexed and Secure Transport</a>", Internet-Draft draft-ietf-quic-transport-10, March 2018.</td>
</tr>
<tr>
<td class="reference"><b id="TLS">[TLS]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-28">The Transport Layer Security (TLS) Protocol Version 1.3</a>", Internet-Draft draft-ietf-tls-tls13-28, March 2018.</td>
</tr>
<tr>
<td class="reference"><b id="TMA-QOF">[TMA-QOF]</b></td>
<td class="top">
<a>Trammell, B.</a>, <a>Gugelmann, D.</a> and <a>N. Brownlee</a>, "<a>Inline Data Integrity Signals for Passive Measurement (in Proc. TMA 2014)</a>", April 2014.</td>
</tr>
<tr>
<td class="reference"><b id="WIRE-IMAGE">[WIRE-IMAGE]</b></td>
<td class="top">
<a>Trammell, B.</a> and <a>M. Kuehlewind</a>, "<a href="https://tools.ietf.org/html/draft-trammell-wire-image-02">The Wire Image of a Network Protocol</a>", Internet-Draft draft-trammell-wire-image-02, February 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#vec" id="vec">The Valid Edge Counter</a>
</h1>
<p id="rfc.section.A.p.1">The Valid Edge Counter (VEC) is an additional two bit signal, encoding values 0 to 3, that works together with the spin bit to help observers reject invalid RTT samples in the presence of loss, reordering, and delayed edges due to application-limited senders.</p>
<p id="rfc.section.A.p.2">To implement the VEC mechanism in addition to the spin bit:</p>
<p></p>

<ul>
<li>Each sender maintains a VEC value, containing the VEC on the last spin edge (a packet that changes the spin value) it received from its peer.</li>
<li>The sender sets the VEC to 0 on any packet not containing a spin edge, or containing a delayed spin edge (a packet that has a spin bit different than the last packet sent, but sent more than a certain amount of time after the incoming packet that changed the spin value).</li>
<li>The sender sets the VEC to its VEC value plus 1 on any packet containing a non-delayed spin edge.</li>
</ul>
<p id="rfc.section.A.p.4">Note that unlike the spin bit, the VEC mechanism is the same on both the client and the server. The endpoints still use the packet number to decide whether or not to update their spin values.</p>
<p id="rfc.section.A.p.5">When measuring RTT using the spin bit with VEC, only edges containing VEC 3 will be used to generate RTT samples.</p>
<p id="rfc.section.A.p.6">This mechanism allows observers to recognize spurious edges due to reordering and delayed edges due to loss, since these packets will have been sent with VEC 0: they were not edges when they were sent. In addition, it allows senders to signal that a valid edge was delayed because the sender was application-limited.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Trammell</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Trammell</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@trammell.ch">ietf@trammell.ch</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mirja Kuehlewind</span> 
	  <span class="n hidden">
		<span class="family-name">Kuehlewind</span>
	  </span>
	</span>
	<span class="org vcardline">ETH Zurich</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mirja.kuehlewind@tik.ee.ethz.ch">mirja.kuehlewind@tik.ee.ethz.ch</a></span>

  </address>
</div>

</body>
</html>
